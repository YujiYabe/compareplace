<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title> compareplace</title>
	<link rel="shortcut icon" href="favicon.ico">
	<link rel="stylesheet"
		href="https://fonts.googleapis.com/css?family=Roboto+Mono:100,300,400,500,700,900|Material+Icons">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lobster">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vuetify/dist/vuetify.min.css">
	<meta id="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">

</head>

<body>
	<div id="app">
		<v-app>
			<v-content>

				<v-container fluid grid-list-md>

					<!-- title ------------------------------------------ -->
					<v-layout justify-center>
						<v-flex xs12>
							<div class="title_text display-4">
								<span class="text_red">compa</span><span class="text_perple">re</span><span
									class="text_blue">place</span>
							</div>
						</v-flex>
					</v-layout>

					<v-layout justify-center>
						<v-flex xs10>
							<br>
							置換後の結果はブラウザに保存されます。<br>
							ブラウザを更新すると続けて置換できます。
						</v-flex>
					</v-layout>


					<v-layout row wrap justify-center :class="{'sticky': dataPosition > 0}">
						<!-- switch mode ------------------------------------------ -->
						<v-flex xs5>
							<v-card flat dark id='mode1' :class="methodClassAplly(1)" v-on:click="methodChangeMode(1)">
								<v-card-text>正規表現なし置換</v-card-text>
							</v-card>
						</v-flex>
						<v-flex xs5>
							<v-card flat dark id='mode2' :class="methodClassAplly(2)" v-on:click="methodChangeMode(2)">
								<v-card-text>正規表現あり置換</v-card-text>
							</v-card>
						</v-flex>

						<!-- keyword area ------------------------------------------ -->
						<v-flex xs5>
							<v-textarea auto-grow :rows="dataKeywordRowHeight" v-on:keyup="methodControlReplace" id="id_pre_keyword"
								v-model="dataPreKeyword" v-on:keydown.tab.prevent="methodInsertTab('id_pre_keyword')"
								background-color="font_mono bg_pink_keyword" placeholder="置換前文字列" color="green">
							</v-textarea>
						</v-flex>
						<v-flex xs5>
							<v-textarea auto-grow :rows="dataKeywordRowHeight" v-on:keyup="methodControlReplace" id="id_pos_keyword"
								v-model="dataPosKeyword" v-on:keydown.tab.prevent="methodInsertTab('id_pos_keyword')"
								background-color="font_mono bg_aqua_keyword" placeholder="置換後文字列" color="yellow">
							</v-textarea>
						</v-flex>
					</v-layout>

					<!-- replace area ------------------------------------------ -->
					<v-layout row wrap justify-center class="z_index_txtBody">
						<v-flex xs5>
							<v-textarea :rows="dataTxtBodyRowHeight" auto-grow background-color="font_mono bg_pink"
								id="id_pre_txtbody" v-model="dataPreTxtbody" placeholder="変更前テキスト"
								v-on:keydown.tab.prevent="methodInsertTab('id_pre_txtbody')" v-on:keyup="methodControlReplace"
								color="green">
							</v-textarea>
						</v-flex>
						<v-flex xs5>
							<v-textarea :rows="dataTxtBodyRowHeight" auto-grow background-color="font_mono bg_aqua"
								v-model="dataPosTxtbody" placeholder="変更後テキスト" readonly color="yellow">
							</v-textarea>
						</v-flex>
					</v-layout>

				</v-container>
			</v-content>
		</v-app>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/vuetify/dist/vuetify.js"></script>
	<link rel="stylesheet" href="compareplace-0.3.css">

	<script>
		var app1 = new Vue({
			el: '#app',
			data: {
				dataPosition: null,
				dataPreKeyword: '',
				dataPosKeyword: '',
				dataPreTxtbody: '',
				dataPosTxtbody: '',
				dataReplaceMode: 1,
				dataKeywordRowHeight: 2,
				dataTxtBodyRowHeight: 30,
			},
			mounted() {
				window.addEventListener('scroll', this.methodHandleScroll);

				this.dataPreKeyword = localStorage.getItem("dataPreKeyword") || "" ;
				this.dataPosKeyword = localStorage.getItem("dataPosKeyword") || "" ;
				this.dataPreTxtbody = localStorage.getItem("dataPreTxtbody") || "" ;
				this.dataReplaceMode = localStorage.getItem("dataReplaceMode") || "" ;
				this.methodClickReplaceMode();
			},

			methods: {
				methodHandleScroll() {
					this.dataPosition = document.documentElement.scrollTop || document.body.scrollTop;
				},

				methodClickReplaceMode() {
					if (this.dataReplaceMode == 1) {
						document.getElementById("mode1").click();
					} else {
						document.getElementById("mode2").click();
					}
				},

				methodInsertTab(target) {
					let tabchar = "\t"
					if (target === "id_pre_keyword") {
						let obj = document.getElementById("id_pre_keyword"); // オブジェクト取得
						let sPos = obj.selectionStart
						let ePos = obj.selectionEnd
						let addStr = obj.value.substr(0, sPos) + tabchar + obj.value.substr(ePos);

						let cPos = sPos + tabchar.length;

						obj.value = addStr;
						this.dataPreKeyword = addStr;
						obj.setSelectionRange(cPos, cPos); // 文字選択状態を初期の状態へ  

					} else if (target === "id_pos_keyword") {
						let obj = document.getElementById("id_pos_keyword"); // オブジェクト取得
						let sPos = obj.selectionStart
						let ePos = obj.selectionEnd
						let addStr = obj.value.substr(0, sPos) + tabchar + obj.value.substr(ePos);

						let cPos = sPos + tabchar.length;

						obj.value = addStr;
						this.dataPosKeyword = addStr;
						obj.setSelectionRange(cPos, cPos); // 文字選択状態を初期の状態へ  

					} else if (target === "id_pre_txtbody") {
						let obj = document.getElementById("id_pre_txtbody"); // オブジェクト取得
						let sPos = obj.selectionStart
						let ePos = obj.selectionEnd
						let addStr = obj.value.substr(0, sPos) + tabchar + obj.value.substr(ePos);

						let cPos = sPos + tabchar.length;


						obj.value = addStr;
						this.dataPreTxtbody = addStr;

						obj.setSelectionRange(cPos, cPos); // 文字選択状態を初期の状態へ  

					}

				},

				methodControlReplace() {
					if (this.dataPreKeyword != "") {
						let dataPreKeyword = this.dataPreKeyword;
						let dataPosKeyword = this.dataPosKeyword;
						let dataPreTxtbody = this.dataPreTxtbody;

						switch (this.dataReplaceMode) {
							case 1:
								this.dataPosTxtbody = dataPreTxtbody.split(dataPreKeyword).join(dataPosKeyword);
								localStorage.setItem("dataPreTxtbody", this.dataPosTxtbody);
								localStorage.setItem("dataPreKeyword", this.dataPreKeyword);
								localStorage.setItem("dataPosKeyword", this.dataPosKeyword);
								break;
							case 2:
								this.dataPosTxtbody = dataPreTxtbody.replace(new RegExp(dataPreKeyword, "g"), dataPosKeyword);
								localStorage.setItem("dataPreTxtbody", this.dataPosTxtbody);
								localStorage.setItem("dataPreKeyword", this.dataPreKeyword);
								localStorage.setItem("dataPosKeyword", this.dataPosKeyword);
								break;
						}
					}
				},

				methodClassAplly(select) {
					let one = select;
					let two = this.dataReplaceMode;
					let applyColor = one === two ? "purple lighten-3" : "grey";
					return applyColor;
				},

				methodChangeMode(select) {
					this.dataReplaceMode = select;
					localStorage.setItem("dataReplaceMode", this.dataReplaceMode);
					this.methodControlReplace();
				},

			}
		})
	</script>
</body>

</html>